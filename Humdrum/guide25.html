<HTML>
<HEAD>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-52162357-1', 'humdrum.org');
  ga('send', 'pageview');
</script>
<TITLE> Humdrum Toolkit User's Guide -- Chapter 25</TITLE>
<!-- Chapter 25 (Similarity) of the User Guide for the Humdrum Toolkit music research software. -->
<meta name="author" content="David Huron">
<meta name="creation-date" content="Tue Sep  1 10:17:29 EDT 1998">
<meta name="revision-date" content="Thu Feb  3 10:15:50 EST 2000">
<meta name="description" content="Chapter 25 (Similarity) of the User Guide for the Humdrum Toolkit music research software.">
<meta name="keywords" content="music research,software,theory,analysis,systematic musicology,computer,software">
<meta name="robots" content="all">
<link href="/Humdrum/Humdrum.css" rel="stylesheet" type="text/css">
</head>


<body>

<table id="header" width="100%">
  <caption></caption>
  <tbody>
    <tr>
      <td valign="middle"><img alt=" " src="/Humdrum/HumdrumIcon.gif"></td>
      <td align="center" valign="middle"><img alt="Humdrum "
        src="/Humdrum/HumdrumHeader.gif"></td>
      <td align="right" valign="middle"><img alt=" "
        src="/Humdrum/HumdrumSpacer.gif"></td>
    </tr>
  </tbody>
</table>


<br>
<br>

<H1>Chapter25</H1>
<CENTER>
<SMALL>
[<A HREF="guide24.html"><i>Previous Chapter</i></A>]
[<A HREF="guide.toc.html"><i>Contents</i></A>]
[<A HREF="guide26.html"><i>Next Chapter</i></A>]
</SMALL>
<center><HR WIDTH=500></center>
<H1>Similarity</H1>
<center><HR WIDTH=500></center>
</CENTER>
</P>
There is no precise way to measure similarity.
However, there are several useful techniques that can be used
to estimate the degree of similarity between different types of information.
In this chapter we discuss two general tools for characterizing
similarity:
<A HREF="commands/correl.html"><b>correl</b></A>
and
<A HREF="commands/simil.html"><b>simil</b></A>.
The
<b>correl</b>
command can be used to measure numerical similarity
between two sets of numbers.
The
<b>simil</b>
command can be used to measure similarity between non-numeric data.
</P>
<P>
In addition, we will discuss the
<b>accent</b>
command -- a tool which estimates how salient or noticeable
a given note is.
The 
<b>accent</b>
command can be used to pre-process musical passages so only
those notes of greatest importance are considered when
measuring musical similarity.
</P>
<A NAME="The_correl_Command">
<H2>The <i>correl</i> Command</H2>
</P>
<A NAME="high_long_pitches">
<P>
One way of measuring similarity is to compare the rise and
fall of two sets of numbers.
Suppose, for example, that we wanted to determine whether
high pitches have a general tendency to be longer in duration than low pitches.
For each note we would establish two numerical values:
one characterizing the pitch height and one characterizing
the duration (say in seconds).
Our data might look as follows:
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>**semits</TD><TD>**dur</TD></TR>
<TR><TD>7</TD><TD>1.00</TD></TR>
<TR><TD>16</TD><TD>1.50</TD></TR>
<TR><TD>14</TD><TD>0.50</TD></TR>
<TR><TD>12</TD><TD>2.00</TD></TR>
<TR><TD>7</TD><TD>1.00</TD></TR>
<TR><TD>4</TD><TD>0.50</TD></TR>
<TR><TD>5</TD><TD>0.50</TD></TR>
<TR><TD>7</TD><TD>1.00</TD></TR>
<TR><TD>*-</TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
This data does seem to exhibit an association between
higher pitches and longer notes.
The longest notes are fairly high (12 and 16 semits),
whereas most of the shortest notes (4 and 5 semits) are lower.
There are some exceptions, however, such as the 0.5 sec. duration
for a pitch of 14 semits.
</P>
<P>
The Humdrum
<A HREF="commands/correl.html"><b>correl</b></A>
command allows us to characterize more precisely the degree of
similarity between two sets of numbers.
The
<b>correl</b>
command expects precisely two input spines;
it is easily invoked:
</P>
<P>
<blockquote>
<code><big>correl inputfile</big></code>
</blockquote>
</P>
<P>
For the above semitone/duration data,
<b>correl</b>
will output the value +0.515.
</P>
<P>
Technically, the
<b>correl</b>
command calculates Pearson's coefficient of correlation between
two spines containing numerical data.
Correlation coefficients range between +1 and -1.
A value of +1 indicates that both sets of numbers rise and fall
in precise synchrony -- although the magnitude of the numbers
may differ.
For example, the following input exhibits a correlation of +1.0
--  even though the two sets of numbers differ in overall magnitude.
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>**foo</TD><TD>**bar</TD></TR>
<TR><TD>1</TD><TD>100</TD></TR>
<TR><TD>3</TD><TD>300</TD></TR>
<TR><TD>2</TD><TD>200</TD></TR>
<TR><TD>1</TD><TD>100</TD></TR>
<TR><TD>*-</TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
If we multiply these numbers by a constant, or if we substract or add
a constant value to each number in one of the spines, they would
still exhibit a correlation of +1.0.
In summary, correlations are insensitive to the absolute magnitude and offsets
for different sets of numbers.
</P>
<P>
A correlation coefficient of -1 means that the rise and fall of
numerical values are exactly reversed.
When one set of numbers is rising, the other set is falling -- and vice versa.
By contrast, a correlation coefficient of zero means that the two
sets of numbers are statistically independent of each other.
For example, comparing two large sets of random numbers will result in
a correlation coefficient near zero.
</P>
<P>
The
<b>correl</b>
command attends only to numerical input data.
Non-numerical data is simply ignored.
If a data token contains a mix of numeric and non-numeric characters,
then only the first complete numerical subtoken is considered.
The following examples illustrate how
<b>correl</b>
interprets mixed data tokens:
<br><br>
<b>Table 25.1</b>
<blockquote><TABLE>
<TR><TD></TD><TD>token</TD><TD></TD><TD>interpretation</TD></TR>
<TR><TD></TD><TD><code><big>4gg#</TD><TD></TD><TD>4</TD></TR>
<TR><TD></TD><TD>4.gg#</TD><TD></TD><TD>4</TD></TR>
<TR><TD></TD><TD>-32aa</TD><TD></TD><TD>-32</TD></TR>
<TR><TD></TD><TD>-aa33</TD><TD></TD><TD>33</TD></TR>
<TR><TD></TD><TD>x7.2yz</TD><TD></TD><TD>7.2</TD></TR>
<TR><TD></TD><TD>a7..2bc</TD><TD></TD><TD>7</TD></TR>
<TR><TD></TD><TD>[+5]12</TD><TD></TD><TD>5</TD></TR>
<TR><TD></TD><TD>$17@2</TD><TD></TD><TD>17</TD></TR>
<TR><TD></TD><TD>=28b</TD><TD></TD><TD>28</TD></TR>
<TR><TD></TD><TD>a1b2 c.3.d</TD><TD></TD><TD>1 0.3</big></code></TD></TR>
</TABLE></blockquote>
<CENTER>
<i>Numerical interpretations of data tokens by <b>correl</b></i>.
</CENTER>
</P>
<P>
Notice in the last example that multiple-stops are treated as
potentially independent numbers.
For example, if the data token encodes a double-stop,
then
<b>correl</b>
</CENTER>
will determine whether both subtokens can be interpreted numerically.
</P>
<P>
In normal operation, the
<b>correl</b>
command expects numerical data to be precisely matched
in both input spines.
That is, if a particular data record contains no numbers
in the left spine, it should also contain no numbers in
the right spine.
Similarly, if the left spine contains three numbers (in a triple stop)
then the right spine must also contain three numbers in the same record.
If there is any breach of the criterion of number pairing,
<b>correl</b>
will issue an error message and stop.
</P>
<P>
Suppose we had a passage of two-part, first species counterpoint
and we were interested in whether the two voices tend toward
contrary and oblique motion rather than parallel and similar motion.
In first species counterpoint, each pitch in the upper voice is
matched with a pitch in the lower voice.
We could measure the pitch-related correlation between the two
parts as follows:
</P>
<P>
<blockquote>
<code><big>semits species1.krn | correl -s ^=</big></code>
</blockquote>
</P>
<P>
The output will consist of a single numerical value.
If the value is positive, then it indicates that the parts tend
to move up and down together in pitch.
That is, a positive correlation indicates a preponderance of
parallel and similar contrapuntal motion.
Conversely, a negative correlation would indicate a preponderance
of contrary and oblique motion.
</P>
<P>
Notice the use of the
<b>-s</b>
option in the above command.
Since common system barlines often contain measure numbers
(e.g. <code><big>=28</big></code>), they are interpretable as numeric data.
For most inputs, the user will not want to have measure numbers
participate in the similarity calculation.
The
<b>-s</b>
option allows the user to specify a regular expression indicating
data records to skip.
</P>
<P>
Now suppose that we wanted to measure a similar pitch-related
correlation for a passage of second species counterpoint.
In second species counterpoint, there are two pitches in the upper
voice for each pitch in the lower voice.
Translating our pitch data to semitones will result in
a failure of the matched-pairs criterion.
There are two ways of overcoming this problem.
One method is to use
<A HREF="commands/ditto.html"><b>ditto</b></A>
to repeat the sustained semitone value for the slower-moving part:
</P>
<P>
<blockquote>
<code><big>semits species2.krn | ditto -s ^= | correl -s ^=</big></code>
</blockquote>
</P>
<P>
Another approach would be to omit from consideration those
notes that are not concurrent with a note in the other voice.
The
<b>-m</b>
option for
<b>correl</b>
disables the matched-pairs criterion.
That is, if numerical data is missing from either one of the input spines,
<A HREF="commands/correl.html"><b>correl</b></A>
will simply discard the entire data record from the correlation calculation.
Using this approach, we would omit the
<b>ditto</b>
command:
</P>
<P>
<blockquote>
<code><big>semits species2.krn | correl -m -s ^=</big></code>
</blockquote>
</P>
<P>
Note that in formal statistical tests, the
<b>-m</b>
option should never be used.
</P>
<A NAME="Using_a_Template_with_correl">
<H2>Using a Template with <i>correl</i></H2>
</P>
<P>
In the above examples,
<b>correl</b>
generates a single output value indicating the degree of
numerical similarity between two spines.
A more valuable use of
<b>correl</b>
involves scanning a spine for portions that are similar to
a brief excerpt or template.
In this mode of operation, the input consists of a single
input spine plus a separate template that represents a
pattern being sought.
</P>
<P>
The
<b>-f</b>
option for
<A HREF="commands/correl.html"><b>correl</b></A>
allows the user to specify a file that acts as a template
which is then scanned across some input.
By way of example, suppose we are looking for motivic instances
similar to the first four notes of
<i>Fr&#232re Jacques</i>.
Our template file might look as follows:
<blockquote>
<img src="guide.figures/guide25.0.gif">
<TABLE>
<TR><TD><code><big>**semits</TD></TR>
<TR><TD>0</TD></TR>
<TR><TD>2</TD></TR>
<TR><TD>4</TD></TR>
<TR><TD>0</TD></TR>
<TR><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
We would like to scan an entire work looking for possible matches
or similar passages.
The following example shows a sample input and corresponding
output -- given the above template.
The left-most spine is the original input represented using the French
<A HREF="representations/solfg.rep.html"><code><big>**solfg</big></code></A>
scheme.
The middle spine is the input (translated to
<A HREF="representations/semits.rep.html"><code><big>**semits</big></code></A>)
supplied to the
<b>correl</b>
command.
The right-most spine was generated using the following command:
</P>
<P>
<blockquote><TABLE>
<TR><TD><code><big>**solfg</TD><TD></TD><TD>**semits</TD><TD></TD><TD>**correl</TD></TR>
<TR><TD>=1</TD><TD></TD><TD>=1</TD><TD></TD><TD>=1</TD></TR>
<TR><TD>do</TD><TD></TD><TD>0</TD><TD></TD><TD>1.000</TD></TR>
<TR><TD>re</TD><TD></TD><TD>2</TD><TD></TD><TD>-0.500</TD></TR>
<TR><TD>mi</TD><TD></TD><TD>4</TD><TD></TD><TD>-0.866</TD></TR>
<TR><TD>do</TD><TD></TD><TD>0</TD><TD></TD><TD>0.866</TD></TR>
<TR><TD>=2</TD><TD></TD><TD>=2</TD><TD></TD><TD>=2</TD></TR>
<TR><TD>do</TD><TD></TD><TD>0</TD><TD></TD><TD>1.000</TD></TR>
<TR><TD>re</TD><TD></TD><TD>2</TD><TD></TD><TD>-0.500</TD></TR>
<TR><TD>mi</TD><TD></TD><TD>4</TD><TD></TD><TD>0.000</TD></TR>
<TR><TD>do</TD><TD></TD><TD>0</TD><TD></TD><TD>0.945</TD></TR>
<TR><TD>=3</TD><TD></TD><TD>=3</TD><TD></TD><TD>=3</TD></TR>
<TR><TD>mi</TD><TD></TD><TD>4</TD><TD></TD><TD>0.982</TD></TR>
<TR><TD>fa</TD><TD></TD><TD>5</TD><TD></TD><TD>-0.327</TD></TR>
<TR><TD>so</TD><TD></TD><TD>7</TD><TD></TD><TD>-0.655</TD></TR>
<TR><TD>=4</TD><TD></TD><TD>=4</TD><TD></TD><TD>=4</TD></TR>
<TR><TD>mi</TD><TD></TD><TD>4</TD><TD></TD><TD>0.982</TD></TR>
<TR><TD>fa</TD><TD></TD><TD>5</TD><TD></TD><TD>.</TD></TR>
<TR><TD>so</TD><TD></TD><TD>7</TD><TD></TD><TD>.</TD></TR>
<TR><TD>*-</TD><TD></TD><TD>*-</TD><TD></TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
The similarity values generated by
<b>correl</b>
are output as a
<A HREF="representations/correl.rep.html"><code><big>**correl</big></code></A>
spine.
Each successive value in the output spine is matched with a data token
in the target input file (<code><big>**semits</big></code>).
For example, the initial output value (1.000) indicates that an exact
positive correlation occurs between the template and the input.
Another exact positive correlation occurs at the beginning of measure 2.
More interesting, perhaps, are the high correlations (+0.982)
at the beginning of measures 3 and 4.
Although the semitone patterns differ (do, re, mi = +2 +2 semits;
mi, fa, so = +1 +2 semits),
the correlations remain high because of the approximate numerical
similarity.
This property gives
<b>correl</b>
a certain flexibility when searching for melodic similarity.
</P>
<P>
For more sophisticated melodic similarity searches,
both pitch and rhythm might be considered.
Two different correlations can be calculated -- one for
semitone contour similarity and one for durational similarity.
We can generate two <code><big>**correl</big></code> spines as follows.
First generate <code><big>**semits</big></code> and <code><big>**dur</big></code> data
so our inputs to
<b>correl</b>
are numerical.
</P>
<P>
<blockquote>
<code><big>semits inputfile > temp.sem</big></code>
<br>
<code><big>dur inputfile > temp.dur</big></code>
</blockquote>
</P>
<P>
Generate independent <code><big>**correl</big></code> spines for the
semitone pitch and duration data, and assemble the
two spines together:
</P>
<P>
<blockquote>
<code><big>correl -s ^= -f template.sem temp.sem > correl.sem</big></code>
<br>
<code><big>correl -s ^= -f template.dur temp.dur > correl.dur</big></code>
<br>
<code><big>assemble correl.sem correl.dur</big></code>
</blockquote>
</P>
<P>
The resulting output consists of two <code><big>**correl</big></code> spines:
one tracing the moment-by-moment pitch similarity,
and the other tracing the moment-by-moment duration similarity.
The output might appear as follows:
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>**correl</TD><TD>**correl</TD></TR>
<TR><TD>0.438</TD><TD>0.284</TD></TR>
<TR><TD>-0.118</TD><TD>0.226</TD></TR>
<TR><TD>0.487</TD><TD>-0.008</TD></TR>
<TR><TD>0.606</TD><TD>0.377</TD></TR>
<TR><TD>0.733</TD><TD>0.648</TD></TR>
<TR><TD>0.514</TD><TD>0.400</TD></TR>
<TR><TD>0.555</TD><TD>0.013</TD></TR>
<TR><TD>0.320</TD><TD>-0.158</TD></TR>
<TR><TD>-0.145</TD><TD>-0.160</big></code></TD></TR>
</TABLE></blockquote>
There are various ways of combining the pitch and duration
data to create a composite similarity measure.
For example, one might sum together the correlations on
each line:
passages that exhibit high pitch/duration similarity will
tend to have a large positive summed score.
Alternatively, one might set a threshold for both each of the
pitch and duration correlation coefficients and use
<A HREF="commands/recode.html"><b>recode</b></A>
to mark promising points of high correlation.
Values between +0.8 and +1.0 might be recoded as "similar";
values between +0.5 and +0.8 might be recoded as "maybe";
all other values might be recoded as null tokens.
Assembling the recoded
<A HREF="representations/correl.rep.html"><code><big>**correl</big></code></A>
spines, one could use
<b>grep</b>
to search for moments in the score that are suitable marked
as "similar" for both pitch and duration.
</P>
<P>
Finally, a word of caution is in order regarding the use of the
<b>correl</b>
command.
Correlation coefficients indicate only the magnitude of the association
between two sets of data.
High correlation values can occur purely by chance.
In particular, the noteworthiness (statistical significance) of a correlation
value depends on the number of input values given in the template.
Longer templates reduce the likelihood of spurious positive correlations.
However, longer templates can also reduce the likelihood of
discovering points of true similarity.
</P>
<A NAME="The_simil_Command">
<H2>The <i>simil</i> Command</H2>
</P>
<P>
The problem of measuring similarity entails two questions:
the
<i>criterion</i>
of similarity and the
<i>metric</i>
of similarity.
</P>
<P>
First, what is the criterion of similarity?
A bassoon is similar to a
<i>cor anglais</i>
in tone color, however a bassoon is more similar to a 'cello in pitch range.
Moreover, the word "bassoon" is more similar in spelling
to "baboon" than either "'cello" or "cor anglais."
The second question is how do we characterize the "distance"
between objects?
How
<i>much</i>
is the difference in pitch range between a 'cello and a bassoon?
How
<i>much</i>
is the difference in spelling between "bassoon" and "baboon"?
</P>
<P>
In the
<A HREF="commands/correl.html"><b>correl</b></A>
command, the criterion of similarity arises from the user's choice
of input representations.
If the input represents duration, then the results pertain to
durational similarity.
If the input represents frequency, then the results pertain to
frequency similarity.
The 
<i>metric</i>
used by
<b>correl</b>
is a linear numerical correlation.
Since
<b>correl</b>
can deal only with numerical data, it is referred to as
"parametric" method for measuring similarity.
However, we know that non-numerical data can also be similar.
An "apple" is more similar to an "orange" than
it is to a "bassoon."
</P>
<P>
The
<A HREF="commands/simil.html"><b>simil</b></A>
command is a "non-parametric" tool for characterizing similarity.
Like <b>correl,</b> the criterion of similarity depends on the user's
choice of input representations.
If the input represents metric position,
then the results pertain to metric-position similarity.
If the input represents phonetic text,
then the results pertain to phonetic similarity, etc.
</P>
<P>
The
<i>metric</i>
used by
<b>simil</b>
is a so-called "edit distance" metric.
The degree of similarity is characterized by how much modification
would be required to transform one representation to another.
By way of example, consider the spelling of the words "bassoon"
and "baboon."
Suppose we are allowed the following operations:
(1) insertion of a character, (2) deletion of a character, and (3)
substitution of a character.
We can transform "bassoon" to "baboon" by deleting a
letter `s' and substituting the letter `b' for the remaining letter `s'.
If each edit operation was assigned a "penalty" value of 1.0,
then we would say that the edit-distance between "bassoon"
and "baboon" is 2.0.
</P>
<P>
Before we describe
<b>simil</b>
in detail, let's examine some sample inputs and outputs.
Two inputs are required by
<b>simil</b>
--  the
<i>source</i>
and
<i>template</i>
inputs.
Both inputs must contain single columns of data;
multi-column inputs are forbidden.
The
<i>source</i>
input must conform to the Humdrum syntax, however the
<i>template</i>
should contain only data records.
</P>
<P>
Depending on the mode of operation,
<A HREF="commands/simil.html"><b>simil</b></A>
outputs either one or two spines of continuous information regarding
the similarity of the two inputs.
The length of <b>simil</b>'s output matches that of the
<i>source</i>
file.
</P>
<P>
The following example illustrates the operation of
<b>simil</b>.
Like <b>correl</b>,
<b>simil</b>
provides a template mode where a relatively short template is
scanned over a source input.
In the following example, the source input is given in the left-most
spine (labelled <code><big>**foo</big></code>) and is held in a file named <code><big>source</big></code>;
the middle column consists of the letters A, B and C, and is held in
a file named <code><big>template</big></code>.
The following command:
</P>
<P>
<blockquote>
<code><big>simil source template</big></code>
</blockquote>
</P>
<P>
generates the third column (labelled
<A HREF="representations/simil.rep.html"><code><big>**simil</big></code></A>):
<br><br>
<blockquote><TABLE>
<TR><TD>(source</TD><TD>(template</TD><TD>(simil</TD></TR>
<TR><TD>input</TD><TD>input)</TD><TD>output)</TD></TR>
<TR><TD><code><big>**foo</TD><TD>A</TD><TD>**simil</TD></TR>
<TR><TD>X</TD><TD>B</TD><TD>0.51</TD></TR>
<TR><TD>A</TD><TD>C</TD><TD>1.00</TD></TR>
<TR><TD>B</TD><TD></TD><TD>0.51</TD></TR>
<TR><TD>C</TD><TD></TD><TD>0.37</TD></TR>
<TR><TD>D</TD><TD></TD><TD>0.51</TD></TR>
<TR><TD>A</TD><TD></TD><TD>0.72</TD></TR>
<TR><TD>B</TD><TD></TD><TD>0.72</TD></TR>
<TR><TD>B</TD><TD></TD><TD>0.51</TD></TR>
<TR><TD>C</TD><TD></TD><TD>0.51</TD></TR>
<TR><TD>B</TD><TD></TD><TD>.</TD></TR>
<TR><TD>A</TD><TD></TD><TD>.</TD></TR>
<TR><TD>*-</TD><TD></TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
Each succesive value in the output spine is matched with a data
token in the source input file.
For example, the second value (1.00) in the <code><big>**simil</big></code> spine arises
from an exact match of the (A,B,C) pattern beginning
with the second data token in the source input.
The second highest value (0.72) occurs in both the sixth and seventh
<code><big>**simil</big></code> data records, indicating that fairly similar
sequences occur beginning with the sixth and seventh data records
in the source input.
Specifically,
<b>simil</b>
has recognized that the sequence (A,B,B,C) is only one edit-operation
(a deletion) different from the template (A,B,C).
In the ensuing record,
<b>simil</b>
has recognized that the sequence (B,B,C) is also only one edit-operation
(substitute  A for B) different from (A,B,C).
Notice that the final value (0.51) indicates that the edit distance
for (C,B,A) is less like the template.
Also notice that the lowest value (0.37) corresponds to an input
pattern (beginning D,D,A) that bears little resemblance to the template.
</P>
<P>
A musically more pertinent example is given below.
Here our template consists of a harmonic pattern:
<i>I-IV-V-I</i>.
<br><br>
<blockquote><TABLE>
<TR><TD>(source</TD><TD>(template</TD><TD>(simil</TD></TR>
<TR><TD>input</TD><TD>input)</TD><TD>output)</TD></TR>
<TR><TD><code><big>**harm</TD><TD>I</TD><TD>**simil</TD></TR>
<TR><TD>I</TD><TD>IV</TD><TD>0.87</TD></TR>
<TR><TD>vi</TD><TD>V</TD><TD>0.87</TD></TR>
<TR><TD>ii7</TD><TD>I</TD><TD>0.51</TD></TR>
<TR><TD>V</TD><TD></TD><TD>0.38</TD></TR>
<TR><TD>V7</TD><TD></TD><TD>0.41</TD></TR>
<TR><TD>I</TD><TD></TD><TD>0.82</TD></TR>
<TR><TD>r</TD><TD></TD><TD>0.41</TD></TR>
<TR><TD>V/V</TD><TD></TD><TD>0.38</TD></TR>
<TR><TD>V</TD><TD></TD><TD>.</TD></TR>
<TR><TD>iii</TD><TD></TD><TD>.</TD></TR>
<TR><TD>iiib</TD><TD></TD><TD>.</TD></TR>
<TR><TD>*-</TD><TD></TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
It is important to understand that
<b>simil</b>
operates by comparing entire data tokens,
so the token <code><big>V7</big></code> differs as much from <code><big>V</big></code> as the token <code><big>vi</big></code>.
It is the user's responsibility to choose an input representation
that facilitates recognition of interchangeable or equivalent data.
For example, in the follow example, the harmonic data given above has been
reclassified (using <b>humsed</b>) so that the number of distinct
harmonic categories has been reduced.
For example, the <code><big>ii7</big></code> chord has been classified as a form of
<code><big>subdom</big></code>inant function.
Notice how the
<A HREF="representations/simil.rep.html"><code><big>**simil</big></code></A>
values better reflect the presumed harmonic similarity:
<br><br>
<blockquote><TABLE>
<TR><TD>(source</TD><TD>(template</TD><TD>(simil</TD></TR>
<TR><TD>input</TD><TD>input)</TD><TD>output)</TD></TR>
<TR><TD><code><big>**Harm</TD><TD>tonic</TD><TD>**simil</TD></TR>
<TR><TD>tonic</TD><TD>subdom</TD><TD>0.92</TD></TR>
<TR><TD>subdom</TD><TD>dom</TD><TD>0.90</TD></TR>
<TR><TD>subdom</TD><TD>tonic</TD><TD>0.87</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>0.44</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>0.41</TD></TR>
<TR><TD>tonic</TD><TD></TD><TD>0.83</TD></TR>
<TR><TD>r</TD><TD></TD><TD>0.66</TD></TR>
<TR><TD>secondary</TD><TD></TD><TD>0.41</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>.</TD></TR>
<TR><TD>mediant</TD><TD></TD><TD>.</TD></TR>
<TR><TD>mediant</TD><TD></TD><TD>.</TD></TR>
<TR><TD>*-</TD><TD></TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
</P>
<P>
<A NAME="Defining_Edit_Penalties">
<H2>Defining Edit Penalties</H2>
</P>
<P>
Technically, the
<A HREF="commands/simil.html"><b>simil</b></A>
command implements a Damerau-Levenshtein metric for edit distance
(see Orpen & Huron, 1992).
Permissible edit operations include substitutions and deletions.
Each edit action incurs a penalty, and the cumulative edit-distance
determines the similarity.
</P>
<P>
In the default operation,
<b>simil</b>
assigns equivalent edit penalties (1.0) for deletions and
substitutions.
However, the user can explicitly define these penalties via an
initialization file.
The initialization file must be named <code><big>simil.rc</big></code> and be
located in the current directory or the user's home directory.
Arbitrary costs may be assigned to any of eight edit operations
shown in Table 25.2.
<br><br>
<b>Table 25.2</b>
<blockquote><TABLE>
<TR><TD>Name Tag</TD><TD>Edit Operation</TD></TR>
<TR><TD>D1</TD><TD>Delete a non-repeated token in String 1</TD></TR>
<TR><TD>D2</TD><TD>Delete a non-repeated token in String 2</TD></TR>
<TR><TD>R1</TD><TD>Delete a repeated token in String 1</TD></TR>
<TR><TD>R2</TD><TD>Delete a repeated token in String 2</TD></TR>
<TR><TD>S0</TD><TD>Substitute a token that is repeated in neither String 1 nor String 2</TD></TR>
<TR><TD>S1</TD><TD>Substitute a token that is repeated in String 1 only</TD></TR>
<TR><TD>S2</TD><TD>Substitute a token that is repeated in String 2 only</TD></TR>
<TR><TD>S3</TD><TD>Substitute a token that is repeated in String 1 and String 2</TD></TR>
</TABLE></blockquote>
<CENTER>
<i>Edit operations used by <b>simil</b></i>.
</CENTER>
</P>
<P>
In describing the edit operations, String 1 is the source string
and String 2 is the template string.
Notice that there is no overt edit operation for insertion:
an insertion in String 1 is equivalent to a deletion in String 2.
However, different edit penalties may be defined for deletions
from String 1 (D1) compared with deletions from String 2 (D2).
In musical applications defining such asymmetrical penalties
may be important.
For example, two inputs may represent a basic melody and an embellished
variant of the melody.
Using asymmetrical penalties allows the user to specify that the
deletion of tones from the embellished version is less costly than
deletion of tones from the basic melody.
</P>
<P>
Since repetition is a common form of musical variation,
<b>simil</b>
allows the user to distinguish between repeated and non-repeated tokens.
A repeated token is defined as one that is immediately preceded by
an identical token.
Thus, in deleting a sequence of identical symbols in String 1, say,
all deletions except the first occurrence are R1 operations,
whereas the deletion of the first occurrence is a D1 operation.
</P>
<P>
Note that the minimum theoretical edit-distance for any set of penalty
weightings can be determined empirically by providing
<b>simil</b>
with source and template strings that share no symbols in common.
For example, the source input may consist entirely of numbers,
whereas the template input consists entirely of alphabetic characters.
In the case where all edit operations are assigned a penalty of +1.0,
the minimum quantitative similarity between two strings is 0.37.
</P>
<P>
Some user-defined weightings may give rise to peculiar results --
such as negative costs -- but
<b>simil</b>
does not forbid this.
<b>Simil</b>
generates warning messages if the weightings seem illogical;
for example, if the cost of R1 is more than that of D1.
In addition,
<A HREF="commands/simil.html"><b>simil</b></A>
will abort operation if the defined edit penalties transgress
the triangular inequality rule (see Orpen & Huron, 1992).
The default weighting for all operations is +1.0.
</P>
<P>
Below is a sample initialization file that defines the R1 substitution
as having an edit penalty of 0.7, whereas the R2 substitution is given
a penalty of 0.9.
Edit penalties are defined by specifying the operation, followed by
some spaces or tabs, followed by some real number.
Since no other penalties are defined in this file, the remaining edit
operations use the default edit penalty of +1.0.
The user can effectively disable a given edit operation by defining
an arbitrarily high edit penalty.
<blockquote><TABLE>
<TR><TD><code><big># This is a comment.</TD></TR>
</TABLE>
<TABLE>
<TR><TD>R1</TD></TD><TD></TD><TD><TD>0.7</TD></TR>
<TR><TD>R2</TD></TD><TD></TD><TD><TD>0.9</big></code></TD></TR>
</TABLE></blockquote>
Raw edit-distance scores are normally unreliable estimates of
similarity, unless the length of the template is considered.
For example, 3 editing operations constitutes a rather modest
change for a template consisting of 20 elements.
However, 3 edit operations is significant for a template
consisting of only 5 elements.
As a result, in the default operation,
<A HREF="commands/simil.html"><b>simil</b></A>
scales the edit-distance scores according to the length of the
comparison template.
This ensures that all similarity values remain between 0 and 1.
</P>
<P>
Now that we better understand the operation of
<i>simil</i>,
let's return to our analysis of the harmonic data illustrated above.
It might be argued that
<i>changing</i>
a chord function is more dissimilar than
<i>repeating</i>
a chord function.
In the following <code><big>simil.rc</big></code> file, an increased penalty has been
assigned for dissimilar substitution, and decreased penalties have
been assigned for repetition.
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>S0</TD><TD>1.6</TD></TR>
<TR><TD>S1</TD><TD>0.7</TD></TR>
<TR><TD>S3</TD><TD>0.7</big></code></TD></TR>
</TABLE></blockquote>
Repeating the above command with this new <code><big>simil.rc</big></code> file
produces the following results:
<br><br>
<blockquote><TABLE>
<TR><TD>(source</TD><TD>(template</TD><TD>(simil</TD></TR>
<TR><TD>input</TD><TD>input)</TD><TD>output)</TD></TR>
<TR><TD><code><big>**Harm</TD><TD>tonic</TD><TD>**simil</TD></TR>
<TR><TD>tonic</TD><TD>subdom</TD><TD>0.94</TD></TR>
<TR><TD>subdom</TD><TD>dom</TD><TD>0.91</TD></TR>
<TR><TD>subdom</TD><TD>tonic</TD><TD>0.87</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>0.45</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>0.41</TD></TR>
<TR><TD>tonic</TD><TD></TD><TD>0.84</TD></TR>
<TR><TD>r</TD><TD></TD><TD>0.68</TD></TR>
<TR><TD>secondary</TD><TD></TD><TD>0.42</TD></TR>
<TR><TD>dom</TD><TD></TD><TD>.</TD></TR>
<TR><TD>mediant</TD><TD></TD><TD>.</TD></TR>
<TR><TD>mediant</TD><TD></TD><TD>.</TD></TR>
<TR><TD>*-</TD><TD></TD><TD>*-</big></code></TD></TR>
</TABLE></blockquote>
Notice that the similarity measure for the pattern (tonic,
subdom, subdom, dom, dom, tonic) has
increased from 0.91 to 0.94.
</P>
<A NAME="similar_fret_patterns">
<P>
The
<A HREF="commands/simil.html"><b>simil</b></A>
command can be used to characterize innumerable types of similarity.
Suppose, for example, that we wanted to identify similar fingering
patterns in music for guitar.
Consider the following work by Ferdinando Carulli:
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>!!!COM: Carulli, Ferdinando</TD></TR>
<TR><TD><code><big>!!!OTL: Larghetto, Opus 124, No. 23</TD></TR>
</TABLE>
<TABLE>
<TR><TD><code><big>!! For guitar.</TD></TR>
<TR><TD><code><big>**fret</TD></TR>
<TR><TD><code><big>*ICstr</TD></TR>
<TR><TD><code><big>*Iguitr</TD></TR>
<TR><TD><code><big>*AT:E2</TD></TR>
<TR><TD><code><big>*RT:0:5:10:15:19:24</TD></TR>
<TR><TD><code><big>*MM60</TD></TR>
<TR><TD><code><big>: : : : |0M :</TD></TR>
<TR><TD><code><big>=1</TD></TR>
<TR><TD><code><big>|0P : : |1bI : |0A</TD></TR>
<TR><TD><code><big>: : : |1bI : |0A</TD></TR>
<TR><TD><code><big>|0P : : |2bI : |2bA</TD></TR>
<TR><TD><code><big>: : : |4dI : |4eA</TD></TR>
<TR><TD><code><big>: : : |2bI : |2bA</TD></TR>
<TR><TD><code><big>=2</TD></TR>
<TR><TD><code><big>|0P : : |1bI : |0A</TD></TR>
<TR><TD><code><big>: : : |1bI : |0A</TD></TR>
<TR><TD><code><big>|0 : : |2bI : |2bA</TD></TR>
<TR><TD><code><big>: : : |4dI : |4eA</TD></TR>
<TR><TD><code><big>: : : |2bI : |2bA</TD></TR>
<TR><TD><code><big>=3</TD></TR>
</TABLE></blockquote>
We might be interested in a fret-board fingering pattern
that consists of the following successive finger combinations:
</P>
<P>
<blockquote>
index finger
<br>
index finger
<br>
ring and little fingers
<br>
index finger
</blockquote>
</P>
<P>
In order to search for similar fingering patterns, we need
to eliminate all but the relevant information from our representation.
In the
<A HREF="representations/fret.rep.html"><code><big>**fret</big></code></A>
scheme, fret-board fingerings are indicated
by the lower-case letters <i>a</i> to <i>e</i> (<i>a</i>=thumb,
<i>b</i>=index finger, <i>c</i>=middle finger, etc.).
The lower-case <i>n</i> is used to explicitly indicate no finger
(i.e. open string(s)).
We can prepare our input using the following
<A HREF="commands/humsed.html"><b>humsed</b></A>
command.
We delete all barlines, and then eliminate all characters other
than the letters <i>a</i> to <i>e</i>.
Any resulting empty lines we replace by the letter <i>n</i>.
</P>
<P>
<blockquote>
<code><big>grep -v ^= carulli | humsed 's/[^a-e]//g; s/^$/n/' carulli</big></code>
</blockquote>
</P>
<P>
The corresponding output would be as follows:
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>!!!COM: Carulli, Ferdinando</TD></TR>
<TR><TD><code><big>!!!OTL: Larghetto, Opus 124, No. 23</TD></TR>
<TR><TD><code><big>!! For guitar.</TD></TR>
<TR><TD><code><big>**fret</TD></TR>
<TR><TD><code><big>*ICstr</TD></TR>
<TR><TD><code><big>*Iguitr</TD></TR>
<TR><TD><code><big>*AT:E2</TD></TR>
<TR><TD><code><big>*RT:0:5:10:15:19:24</TD></TR>
<TR><TD><code><big>*MM60</TD></TR>
<TR><TD><code><big>n</TD></TR>
<TR><TD><code><big>b</TD></TR>
<TR><TD><code><big>b</TD></TR>
<TR><TD><code><big>bb</TD></TR>
<TR><TD><code><big>de</TD></TR>
<TR><TD><code><big>bb</TD></TR>
<TR><TD><code><big>b</TD></TR>
<TR><TD><code><big>b</TD></TR>
<TR><TD><code><big>bb</TD></TR>
<TR><TD><code><big>de</TD></TR>
<TR><TD><code><big>bb</TD></TR>
</TABLE></blockquote>
The appropriate template file would contain the following finger
successions:
<br><br>
<blockquote><TABLE>
<TR><TD><code><big>b</TD></TR>
<TR><TD>b</TD></TR>
<TR><TD>de</TD></TR>
<TR><TD>b</big></code></TD></TR>
</TABLE></blockquote>
</P>
<A NAME="The_accent_Command">
<H2>The <i>accent</i> Command</H2>
</P>
<P>
Both the
<A HREF="commands/correl.html"><b>correl</b></A>
and
<A HREF="commands/simil.html"><b>simil</b></A>
tools presume that all data tokens are equally important.
In the case of <b>correl</b>,
each number is weighted equally in calculating the coefficient of
correlation.
In the case of <b>simil</b>,
each data token has the same potential for disrupting the
similarity measure.
</P>
<P>
In musical circumstances, we are aware that not
all notes are equally important.
Some notes are more perceptually more noticeable.
The effectiveness of both
<b>correl</b>
and
<b>simil</b>
can be increased significantly if we first "filter" our data
--  selecting only the most important -- s of data for consideration.
</P>
<P>
The
<b>accent</b>
command implements a sophisticated model of the perceptual salience
or noticeability for various pitches.
The command accepts only monophonic
<A HREF="representations/kern.rep.html"><code><big>**kern</big></code></A>
input and outputs a spine containing
numerical values estimating the noticeability of
each note.
Output accent values vary between 0 (minimum accent)
and 1 (maximum accent).
Input is limited to only a single <code><big>**kern</big></code> data spine.
</P>
<P>
The
<b>accent</b>
command takes into account seven factors: (1) the duration
of notes (agogic stress),
(2) the amount of melodic (or pitch-related) accent,
(3) metric position,
(4) position in scale-degree hierarchy,
(5) primacy/recency contexts,
(6) explicit accent/articulation marks, and
(7) inner-voice or outer-voice position.
No attempt is made to account for melodic expectancy,
past experience, or other factors known to influence the perceptual
salience of particular notes.
</P>
<P>
By way of illustration, consider the two passages shown in Example 25.1:
from Wagner's
<i>Rienzi</i>
opera, and the Scottish folksong <b>My Bonnie</b>.
Two sample outputs from
<b>accent</b>
are given below.
In both examples the left-most spine shows the input,
and the right-most spine shows the corresponding output:
<br><br>
<b>Example 25.1.</b>  Richard Wagner, <i>Rienzi</i> Theme.  Anon. <i>My Bonnie Lies Over the Ocean</i>.
<blockquote>
<img src="guide.figures/guide25.1a.gif">
<br>
<img src="guide.figures/guide25.1b.gif">
<blockquote><TABLE>
<TR><TD><code><big>!!!COM: Wagner, Richard</TD></TR>
<TR><TD><code><big>!!!OTL: Rienzi Overture</TD></TR>
</TABLE>
<TABLE>
<TR><TD><code><big>**kern</TD><TD></TD><TD><code><big>**accent</TD></TR>
<TR><TD><code><big>*M4/4</TD><TD></TD><TD><code><big>*M4/4</TD></TR>
<TR><TD><code><big>*D:</TD><TD></TD><TD><code><big>*D:</TD></TR>
<TR><TD><code><big>=1</TD><TD></TD><TD><code><big>=1</TD></TR>
<TR><TD><code><big>4.d</TD><TD></TD><TD><code><big>0.76 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>32c#</TD><TD></TD><TD><code><big>0.48</TD></TR>
<TR><TD><code><big>32d</TD><TD></TD><TD><code><big>0.46</TD></TR>
<TR><TD><code><big>32e</TD><TD></TD><TD><code><big>0.47</TD></TR>
<TR><TD><code><big>32d</TD><TD></TD><TD><code><big>0.46</TD></TR>
<TR><TD><code><big>4.b</TD><TD></TD><TD><code><big>0.63 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>8a</TD><TD></TD><TD><code><big>0.52</TD></TR>
<TR><TD><code><big>=2</TD><TD></TD><TD><code><big>=2</TD></TR>
<TR><TD><code><big>4g</TD><TD></TD><TD><code><big>0.68 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>4e</TD><TD></TD><TD><code><big>0.62 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>4d</TD><TD></TD><TD><code><big>0.66 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>4A</TD><TD></TD><TD><code><big>0.65 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>*-</TD><TD></TD><TD><code><big>*-</TD></TR>
</TABLE></blockquote>
<blockquote><TABLE>
<TR><TD><code><big>!!!OTL: My Bonnie Lies Over the Ocean</TD></TR>
</TABLE>
<TABLE>
<TR><TD><code><big>**kern</TD><TD><code><big>**accent</TD></TR>
<TR><TD><code><big>*M3/4</TD><TD><code><big>*M3/4</TD></TR>
<TR><TD><code><big>*G:</TD><TD><code><big>*G:</TD></TR>
<TR><TD><code><big>4d</TD><TD><code><big>0.705 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>=1</TD><TD><code><big>=1</TD></TR>
<TR><TD><code><big>4.b</TD><TD><code><big>0.729 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>8a</TD><TD><code><big>0.513</TD></TR>
<TR><TD><code><big>4g</TD><TD><code><big>0.671 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>=2</TD><TD><code><big>=2</TD></TR>
<TR><TD><code><big>4a</TD><TD><code><big>0.676 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>4g</TD><TD><code><big>0.652 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>4e</TD><TD><code><big>0.633 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>=3</TD><TD><code><big>=3</TD></TR>
<TR><TD><code><big>4d</TD><TD><code><big>0.696 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>2B</TD><TD><code><big>0.659 </big></code>*<code><big></TD></TR>
<TR><TD><code><big>*-</TD><TD><code><big>*-</TD></TR>
</TABLE></blockquote>
</blockquote>
The similarity between these two passages is more evident
when the perceptually more salient tones are considered alone.
Using the
<A HREF="representations/accent.rep.html"><code><big>**accent</big></code></A>
data, we might simplify one or both
passages by extracting only those notes whose accent value
exceeds some threshold.
In the above examples, a threshold of 0.6 might be appropriate
(marked with an asterisk).
We can isolate these tones by using the
<A HREF="commands/recode.html"><b>recode</b></A>
and
<A HREF="commands/yank.html"><b>yank</b></A>
commands.
First, we create an appropriate reassignment file for <b>recode</b>.
In this case we have classified all notes as either primary,
secondary, or tertiary:
</P>
<P>
<blockquote>
<code><big>>=0.6	primary
<br>
>=0.5	secondary
<br>
else	tertiary</big></code>
</blockquote>
</P>
<P>
Assuming this file is named <code><big>reassign</big></code>, we can pre-process
our passage as follows:
</P>
<P>
<blockquote>
<code><big>recode -f reassign -s ^= -i '**accent' inputfile \
<blockquote>
| yank -m primary -r 0 | extract -i '**kern' > primary.krn</big></code>
</blockquote>
</blockquote>
</P>
<P>
The file <code><big>primary.krn</big></code> contains only those notes having
the highest estimated accent values.
Using this file, we can continue processing using either
a parametric (<b>correl</b>) or non-parametric (<b>simil</b>)
similarity method.
</P>
<hr>
<A NAME="Reprise">
<H2>Reprise</H2>
</P>
<P>
In this chapter we have introduced two types of similarity tools:
<A HREF="commands/correl.html"><b>correl</b></A>
and
<A HREF="commands/simil.html"><b>simil</b></A>.
For both tools, the criterion of similarity depends on the
user's choice of input representation.
For example, if the input represents fret-board finger patterns,
then the similarity measures will reflect fret-board fingering
similarity.
Users need to choose carefully the type of pre-processing
required to address the specific domain of interest.
</P>
<P>
In particular, we noted that the Humdrum
<b>accent</b>
provides a useful way of pre-processing passages so that only
the structurally most important notes are considered during processing.
</P>
<P>
The
<b>correl</b>
command provides a way for measuring
<i>parametric</i>
similarity -- where similarity is based on numerical resemblance.
By contrast, the
<b>simil</b>
command provides a way for measuring
<i>non-parametric</i>
similarity:
similar inputs are ones that require the least editing in order for
one input to be made equivalent to the other.
We saw that
<b>simil</b>
allows the user to define the edit penalties associated with
different kinds of modifications.
This allows the user to tailor the similarity measures to better
suit the type of data being considered.
</P>
<P>
The tools described in this chapter complement the pattern
searching tools (such as
<A HREF="commands/patt.html"><b>patt</b></A>,
<A HREF="commands/pattern.html"><b>pattern</b></A>
and
<b>grep</b>)
described earlier.
<hr>
<br>
<ul>
<li>
<A HREF="guide26.html">
<B>Next Chapter</B></A>
<li>
<A HREF="guide24.html">
<B>Previous Chapter</B></A>
<li>
<A HREF="guide.toc.html">
<B>Table of Contents</B></A>
<li>
<A HREF="guide.toc.detailed.html">
<B>Detailed Contents</B></A>
<br><br>

&copy; Copyright 1999 David Huron
</BODY>
</HTML>
