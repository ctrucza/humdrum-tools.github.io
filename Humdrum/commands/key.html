<HTML>
<HEAD>
<TITLE>Humdrum Toolkit Command Reference -- key</TITLE>
<link href="../../Humdrum.css" rel="stylesheet" type="text/css">
</HEAD>


<BODY>

<table id="header" width="100%">
  <caption></caption>
  <tbody>
    <tr>
      <td valign="middle"><img alt=" " src="../../HumdrumIcon.gif"></td>
      <td align="center" valign="middle"><img alt="Humdrum "
        src="../../HumdrumHeader.gif"></td>
      <td align="right" valign="middle"><img alt=" "
        src="../../HumdrumSpacer.gif"></td>
    </tr>
  </tbody>
</table>



</P>
</P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>COMMAND</H3></FONT>
<b>key</b>  --  estimate the key for a Humdrum passage
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>SYNOPSIS</H3></FONT>
<code><big>
<b>key</b>  [<b>-af</b>]  [<i>inputfile</i> ...]
</code></big>
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>DESCRIPTION</H3></FONT>
The
<b>key</b>
command estimates the key of a given musical passage using
Krumhansl's tonal hiearchy method.
The command is restricted to identifying only those keys within
the common major/minor tonal system.
Modes outside the major/minor system are not recognized.
</P>
<P>
The input may be either
<code><big>
**semits
</i></b></code></big>
</i></b></code></big>
or
<code><big>
**kern
</i></b></code></big>
</i></b></code></big>
representations.
The program adapts to input having varying
numbers spines each with a different interpretation.
</P>
<P>
Output consists of three items of information:
<ul>
<li>
the
<i>estimated key</i>
for the passage,
<li>
a
<i>coefficient of correlation</i>
(Pearson's "r") that measures how well the pitch organization of the
musical passage conforms to an idealized major or minor key template, and
<li>
a
<i>confidence score</i>
that indicates how distinctive the key-match is compared with other
competing keys.
A confidence score of 100% indicates a very strong confidence in the
key estimate;
low confidence scores indicate that there is at least one other key that
is a good alternative candidate.
</ul>
</P>
<P>
The algorithm is based on Krumhansl's perceptually-based key-finding method
(see <A HREF="#REFERENCES">references</A>).
This method compares a given pitch-class
frequency profile with two perceptually-determined prototypes
(one each for major and minor modes).
The coefficients used for these prototypes are those
determined by
<A HREF="#Krumhansl and Kessler">
Krumhansl & Kessler (1982).</A>
In order for the algorithm to work properly, durational information
ought to be provided.
When using
<code><big>
**semits
</code></big>
format input, best results are achieved when
the input has a
<i>time-base</i>
format.
(See the
<A HREF="timebase.html"><b>timebase</A> (4)</b>
command.)
</P>
<P>
The
<b>key</b>
command is poor at distinguishing less common enharmonic keys.
For example, it is unable to distinguish the following enharmonic spellings
for tonic pitches: C-flat, B-sharp, E-sharp, F-flat.
Also,
<b>key</b>
is unable to distinguish enharmonic spellings involving
double- or triple- sharps or flats.
That is, G double-sharp major is identified as A major.
KEY is able to distinguish the
more common enharmonic spellings (such as E-flat versus D-sharp).
</P>
<P>
There is no special output file-type designation.
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>OPTIONS</H3></FONT>
The
<b>key</b>
command provides the following options:
<blockquote><TABLE>
<TR><TD><b>-a</b></TD><TD>output correlation values for all keys</TD></TR>
<TR><TD><b>-f</b></TD><TD>output frequencies for all pitch-classes</TD></TR>
<TR><TD><b>-h</b></TD><TD>displays a help screen summarizing the command syntax</TD></TR>
</TABLE></blockquote>
Options are specified in the command line.
</P>
<P>
The
<b>-a</b>
option will show all of the correlation coefficients
for all 24 of the (enharmonic) major and minor keys.
</P>
<P>
The
<b>-f</b>
option will output the relative frequencies for each of
the twelve chromatic pitch classes (in quarter-note durations).
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>SAMPLE OUTPUT</H3></FONT>
Without any options, typical outputs are of the following form:
</P>
<P>
<code><big>
Estimated key: B minor    (r=0.8442)     confidence: 51.3%
</i></b></code></big>
</i></b></code></big>
</P>
<P>
With both the
<b>-f</b>
and
<b>-a</b>
options invoked, a typical output is given below.
The
<b>-f</b>
option causes 12 pitch-class tallies to be outputted.
These values are given in acculumated whole-note durations.
For example, the output: "PC[5]: 4.25" means that the
enharmonic pitch-class "F" appears in the passage for the
equivalent of 4 whole-notes plus a quarter-note duration.
If inputs do not include durational information (such as in
<code><big>
**semits
</i></b></code></big>
</i></b></code></big>
input), each note is assigned the nominal duration of a quarter-note.
<blockquote>
<TABLE>
<code><big>
<TR><TD>PC[0]: 5.50617</TD></TR>
<TR><TD>PC[1]: 0.375</TD></TR>
<TR><TD>PC[2]: 6.1875</TD></TR>
<TR><TD>PC[3]: 0</TD></TR>
<TR><TD>PC[4]: 5.625</TD></TR>
<TR><TD>PC[5]: 4.25</TD></TR>
<TR><TD>PC[6]: 1.25</TD></TR>
<TR><TD>PC[7]: 5.6875</TD></TR>
<TR><TD>PC[8]: 0.5</TD></TR>
<TR><TD>PC[9]: 4.625</TD></TR>
<TR><TD>PC[10]: 0.625</TD></TR>
<TR><TD>PC[11]: 4.40625</TD></TR>
<TR><TD>Tonic[0]	major 0.791744	minor 0.0962456</TD></TR>
<TR><TD>Tonic[1]	major -0.747033	minor -0.337397</TD></TR>
<TR><TD>Tonic[2]	major 0.506935	minor 0.535771</TD></TR>
<TR><TD>Tonic[3]	major -0.404982	minor -0.720203</TD></TR>
<TR><TD>Tonic[4]	major 0.0308014	minor 0.64007</TD></TR>
<TR><TD>Tonic[5]	major 0.475928	minor -0.13113</TD></TR>
<TR><TD>Tonic[6]	major -0.735928	minor -0.157988</TD></TR>
<TR><TD>Tonic[7]	major 0.772586	minor 0.205276</TD></TR>
<TR><TD>Tonic[8]	major -0.574103	minor -0.487743</TD></TR>
<TR><TD>Tonic[9]	major 0.232566	minor 0.66303</TD></TR>
<TR><TD>Tonic[10]	major -0.014411	minor -0.625767</TD></TR>
<TR><TD>Tonic[11]	major -0.334105	minor 0.319835</TD></TR>
<TR><TD>Estimated key: C major     (r=0.7917)     confidence:   5.7%</TD></TR>
</code></big>
</TABLE>
</blockquote>
The
<b>-a</b>
option causes the tonic major and minor correlations to be
printed for each pitch-class.
Good key matches have a high positive correlation;
the maximum value is 1.0.
</P>
<P>
In the above sample output, notice that the confidence score for the
predicted key of C major (Tonic[0]) is quite low.
The reason for this is that the correlation coefficient for A minor
(Tonic[9]) is rather close to that for C major (0.791744 versus 0.66303)
Note that confidence scores may be used as a simple index
for estimating the tonal ambiguity or degree of chromaticism for a passage.
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>PORTABILITY</H3></FONT>
DOS 2.0 and up, with the MKS Toolkit.
OS/2 with the MKS Toolkit.
UNIX systems supporting the
<i>Korn</i>
shell or
<i>Bourne</i>
shell command interpreters, and revised
<i>awk</i>
(1985).
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>SEE ALSO</H3></FONT>
<code><big>
<b>**kern</b> (2),
<A HREF="kern.html">
<b>kern</b></A> (4),
<b>**semits</b> (2),
<A HREF="semits.html">
<b>semits</b></A> (4),
<A HREF="timebase.html">
<b>timebase</b></A> (4)
</i></b></code></big>
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>WARNINGS</H3></FONT>
As noted,
<b>key</b>
is very limited.
When used to find "the key" of a particular work,
it frequently produces incorrect results.
In particular, for much tonal music,
<b>key</b>
has a tendency to mistakenly identify the dominant of the
key rather than the tonic.
See also the discussion under "proposed modifications."
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>BUGS</H3></FONT>
The current version does not handle multiple stops in
<code><big>
**kern
</i></b></code></big>
</i></b></code></big>
spines.
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>NOTES</H3></FONT>
Currently the program is sensitive to
<code><big>
**semits
</i></b></code></big>
</i></b></code></big>
and
<code><big>
**kern
</i></b></code></big>
</i></b></code></big>
interpretations.
If no recognizable interpretation is
given in the input stream,
<b>key</b>
assumes
<code><big>
**kern
</i></b></code></big>
</i></b></code></big>
compatible input.
This may lead to erroneous results.
</P>
<P>
<center><HR WIDTH=500></center>
<A NAME="REFERENCES">
<FONT color="0000FF"><H3>REFERENCES</H3></FONT>
Krumhansl, C.
<i>Cognitive Foundations of Musical Pitch,</i>
Oxford: Oxford University Press, 1990, Chapter 4.
</P>
<A NAME="Krumhansl and Kessler">
<P>
Krumhansl, C. L. & Kessler, E. J.
"Tracing the dynamic changes in perceived tonal organization in a spatial
representation of musical keys,"
<i>Psychological Review,</i>
Vol. 89 (1982) pp.334-368.
</P>
<P>
<center><HR WIDTH=500></center>
<FONT color="0000FF"><H3>PROPOSED MODIFICATIONS</H3></FONT>
The
<b>key</b>
command is likely to appeal to two types of uses:
(1) those who are interested in knowing the key of a musical work
without having to examine the work manually,
or (2) those who are interested in a perceptual characterization
of the tonality of a passage.
These goals are quite different.
The current
<b>key</b>
command implements the second approach;
<b>key</b>
is not very good at consistently and correctly identifying "The Key"
of typical tonal works.
Another command (or variant of the
<b>key</b>
command) might use contextual heuristics (such as looking at the
final chord of a work, or examining cadences) in order to better
identify "the key" of a work.
<hr>
<br>
<ul>
<li>
<A HREF="../commands.toc.html">
<B>Index to Humdrum Commands</B></A>
<li>
<A HREF="../guide.toc.html">
<B>Table for Contents for Humdrum User Guide</B></A>
</ul>
<br><br>

</BODY>
</HTML>
