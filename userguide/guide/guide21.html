

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chapter21 &mdash; humdrum-tools 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="humdrum-tools 1 documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">humdrum-tools 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Chapter21</a></li>
<li><a class="reference internal" href="#searching-for-patterns">Searching for Patterns</a><ul>
<li><a class="reference internal" href="#the-patt-command">The <em>patt</em> Command</a></li>
<li><a class="reference internal" href="#using-patt-s-tag-option">Using <em>patt</em>&#8216;s Tag Option</a></li>
<li><a class="reference internal" href="#matching-multiple-records-using-the-patt-command">Matching Multiple Records Using the <em>patt</em> Command</a></li>
<li><a class="reference internal" href="#the-pattern-command">The <em>pattern</em> Command</a></li>
<li><a class="reference internal" href="#patterns-of-patterns">Patterns of Patterns</a></li>
<li><a class="reference internal" href="#reprise">Reprise</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/userguide/guide/guide21.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <img alt="" src="userguide/guide/../HumdrumIcon.gif" />
<img alt="Humdrum" src="userguide/guide/../HumdrumHeader.gif" />
<img alt="" src="userguide/guide/../HumdrumSpacer.gif" />
<div class="section" id="chapter21">
<h1>Chapter21<a class="headerlink" href="#chapter21" title="Permalink to this headline">¶</a></h1>
<p>[<a href="#id39"><span class="problematic" id="id40">`*Previous Chapter*`_</span></a>] [<a href="#id41"><span class="problematic" id="id42">`*Contents*`_</span></a>] [<a href="#id43"><span class="problematic" id="id44">`*Next Chapter*`_</span></a>]</p>
</div>
<hr class="docutils" />
<div class="section" id="searching-for-patterns">
<h1>Searching for Patterns<a class="headerlink" href="#searching-for-patterns" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>The <strong>grep</strong> and <strong>egrep</strong> commands are useful for identifying patterns that
occur on single lines. As we saw in <a class="reference external" href="guide19.html">Chapter 19,</a> the <a href="#id45"><span class="problematic" id="id46">`**context**`_</span></a> command
can be used to amalgamate groups of successive data tokens on a single line
&#8211; and so facilitate searching for sequential patterns using <strong>grep</strong> or
<strong>egrep</strong>. For many tasks, the combination of <strong>context</strong> and <strong>grep</strong>
provides the most convenient way to search for user-specified patterns.
However, not all patterns can be conveniently identified using this approach.
In this chapter we will introduce two additional tools that are intended to
search directly for sequential patterns without having to use <strong>context</strong> to
create pseudo-simultaneous collections.</p>
<div class="section" id="the-patt-command">
<h2>The <em>patt</em> Command<a class="headerlink" href="#the-patt-command" title="Permalink to this headline">¶</a></h2>
<p>The <a href="#id47"><span class="problematic" id="id48">`**patt**`_</span></a> command may be regarded as a two-dimensional version of
<strong>grep</strong>. Like <strong>grep</strong>, <strong>patt</strong> searches for lines that match user-
specified regular expressions. However, unlike <strong>grep</strong>, <strong>patt</strong> can search
for a sequence of records that match a sequence of user-specified regular
expressions. Specifically, <strong>patt</strong> will look for an input line that matches
the first (of potential many) user-specified regular expression. Then
<strong>patt</strong> will determine whether the following input line matches the second
user-specified regular expression ... and so on, until the entire sequence of
the user-specified regular expressions are exhausted. A pattern match is
deemed to occur only if all of the successive regular expressions match a
contiguous sequence of input lines.</p>
<p>The operation of <strong>patt</strong> is easier to describe through an example. Consider
the following input using the German <em>Tonhohe</em> pitch designations described
in <a class="reference external" href="guide04.html">Chapter 4.</a> Recall that the <a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id49"><span class="problematic" id="id50">`**Tonh```_</span></a> system of pitch names allows
Bach to spell his name (B=B-flat; H=B-natural). Less well-known is the fact
that Dmitri Shostakovich also used the German pitch system to create motives
based on his name: D-S-C-H (S=Es=E-flat). (The German transliteration of the
cyrillic is Schostakowitsch.)</p>
<p>&gt; <tt class="docutils literal"><span class="pre">**Tonh</span>
<span class="pre">&gt;</span> <span class="pre">``D4</span>
<span class="pre">&gt;</span> <span class="pre">``Es4</span>
<span class="pre">&gt;</span> <span class="pre">``C4</span>
<span class="pre">&gt;</span> <span class="pre">``H3</span>
<span class="pre">&gt;</span> <span class="pre">``*-</span></tt></p>
<p>Suppose we were looking for possible instances of D-S-C-H. The <strong>patt</strong>
command requires a template file that contains one or more successive regular
expressions. A suitable template file (named <tt class="docutils literal"><span class="pre">dmitri</span></tt>) would be as follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">D</span>
<span class="pre">&gt;</span> <span class="pre">``Es</span>
<span class="pre">&gt;</span> <span class="pre">``C</span>
<span class="pre">&gt;</span> <span class="pre">``H</span></tt></p>
<p>We would invoke the search as follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">patt</span> <span class="pre">-f</span> <span class="pre">dmitri</span></tt> <em>inputfile</em></p>
<p>The <strong>-f</strong> option is mandatory: it conveys to <strong>patt</strong> the name of the
template file used in the search.</p>
<p>In the default operation, <strong>patt</strong> simply outputs a global comment
identifying the location of any matching segments. One global comment is
output for each matching pattern. In the above case, the output would be as
follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">!!</span> <span class="pre">Pattern</span> <span class="pre">found</span> <span class="pre">at</span> <span class="pre">line</span> <span class="pre">2</span> <span class="pre">of</span> <span class="pre">file</span> <span class="pre">Tonh</span></tt></p>
<p>The <a href="#id51"><span class="problematic" id="id52">`**patt**`_</span></a> command will also identify any overlapping patterns. For
example, suppose we had an input containing an ostinato figure in minor
thirds:</p>
<p><strong>Example 21.1.</strong> <a href="#id3"><span class="problematic" id="id4">`</span></a>DSCH&#8217; Ostinato.</p>
<p>&gt; .. image:: guide.figures/guide21.1.gif</p>
<p>&gt;
&gt;&gt; <tt class="docutils literal"><span class="pre">**Tonh**Tonh</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*k[b-e-]*K[b-e-]</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*M9/8*M9/8</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``=1-=1-</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``H3D4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``H3D4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``C4Es4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``H3D4</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``==</span></tt></p>
<p>If we applied the above <strong>patt</strong> command to this <tt class="docutils literal"><span class="pre">ostinato</span></tt> file, we would
get the following output:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">!!</span> <span class="pre">Pattern</span> <span class="pre">found</span> <span class="pre">at</span> <span class="pre">line</span> <span class="pre">8</span> <span class="pre">of</span> <span class="pre">file</span> <span class="pre">ostinato</span></tt>
<tt class="docutils literal"><span class="pre">!!</span> <span class="pre">Pattern</span> <span class="pre">found</span> <span class="pre">at</span> <span class="pre">line</span> <span class="pre">11</span> <span class="pre">of</span> <span class="pre">file</span> <span class="pre">ostinato</span></tt></p>
<p>We can instruct <strong>patt</strong> to output specific instances of the pattern using
the <strong>-e</strong> (echo) option. Consider the following command:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">patt</span> <span class="pre">-f</span> <span class="pre">dmitri</span> <span class="pre">-e</span> <span class="pre">ostinato</span></tt></p>
<p>The resulting output would be:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">!!</span> <span class="pre">Pattern</span> <span class="pre">found</span> <span class="pre">at</span> <span class="pre">line</span> <span class="pre">4</span> <span class="pre">of</span> <span class="pre">file</span> <span class="pre">ostinato</span>
<span class="pre">&gt;</span> <span class="pre">``**Tonh``**Tonh</span>
<span class="pre">&gt;</span> <span class="pre">``H3``D4</span>
<span class="pre">&gt;</span> <span class="pre">``C4``Es4</span>
<span class="pre">&gt;</span> <span class="pre">``C4``Es4</span>
<span class="pre">&gt;</span> <span class="pre">``H3``D4</span>
<span class="pre">&gt;</span> <span class="pre">``*-``*-</span>
<span class="pre">&gt;</span> <span class="pre">``!!</span> <span class="pre">Pattern</span> <span class="pre">found</span> <span class="pre">at</span> <span class="pre">line</span> <span class="pre">7</span> <span class="pre">of</span> <span class="pre">file</span> <span class="pre">ostinato</span>
<span class="pre">&gt;</span> <span class="pre">``**Tonh``**Tonh</span>
<span class="pre">&gt;</span> <span class="pre">``H3``D4</span>
<span class="pre">&gt;</span> <span class="pre">``C4``Es4</span>
<span class="pre">&gt;</span> <span class="pre">``C4``Es4</span>
<span class="pre">&gt;</span> <span class="pre">``H3``D4</span>
<span class="pre">&gt;</span> <span class="pre">``*-``*-</span></tt></p>
<p>Notice that each instance of the found pattern is output as a stand-alone
humdrum &#8220;mini-encoding,&#8221; complete with initial exclusive interpretations and
terminating spine-path terminators.</p>
<p><strong>Example 21.2.</strong> J.S. Bach, <em>Well-Tempered Clavier</em>, Vol. 1, Fugue 2.</p>
<p>&gt; .. image:: guide.figures/guide21.2.gif</p>
<p>Most Baroque composers were fond of ending works written in minor keys on the
tonic major chord &#8211; the so-called <em>tierce de picardie</em> or Picardy Third.
Example 21.2 shows a typical example from the final measures of Bach&#8217;s second
fugue from the <em>Well-Tempered Clavier</em>, vol. 1. Suppose that we wanted to
identify all works in some repertory that end with a <em>tierce de picardie</em>. We
need to search for a raised third scale degree in close proximity to the end
of a work for those works in a minor key. First we might identify those works
in minor keys. The following <strong>grep</strong> command will search all files in the
current directory for a tandem interpretation indicating a minor key. Recall
that minor keys are identified by an asterisk followed by a lower-case pitch-
letter name, followed by an optional accidental, followed by the colon
character. The <strong>-l</strong> option will list all files that containing a matching
record:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">grep</span> <span class="pre">-l</span> <span class="pre">'^\*[a-g][-#]*:'</span> <span class="pre">*</span></tt></p>
<p>Recall that the <a href="#id53"><span class="problematic" id="id54">`**deg**`_</span></a> command is mode sensitive, whereas the
<a href="#id55"><span class="problematic" id="id56">`**solfa**`_</span></a> command is mode insensitive. That is, in the key of C major,
<strong>deg</strong> will represent the pitch E as <tt class="docutils literal"><span class="pre">3</span></tt> and in C minor <strong>deg</strong> will
represent the pitch E (natural) as <tt class="docutils literal"><span class="pre">3+</span></tt>. By contrast, the <strong>solfa</strong> command
will represent E as <tt class="docutils literal"><span class="pre">`mi</span></tt>&#8216; whether the mode is major or minor.</p>
<p>In order to locate picardy thirds, we can look for raised mediants in the
<tt class="docutils literal"><span class="pre">**deg</span></tt> representation. Specifically, we can look for a raised mediant
pitch immediately prior to a double barline. Our template file (dubbed
&#8220;<tt class="docutils literal"><span class="pre">picardy</span></tt>&#8221;) might look as follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">3[+]</span>
<span class="pre">==</span></tt></p>
<p>Notice that the plus sign has been placed in square brackets. The <strong>patt</strong>
command accepts only <em>extended</em> regular expressions. The plus sign is a
metacharacter that normally indicates &#8220;one or more instances.&#8221; So placing it
in square brackets causes the special meaning to be escaped.</p>
<p>In order to search for such picardy thirds, we should translate each input
file to the <tt class="docutils literal"><span class="pre">**deg</span></tt> representation, and then search for raised mediants
immediately prior to a double bar:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">deg</span> <span class="pre">*inputfile.krn*</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-f</span> <span class="pre">picardy</span></tt></p>
<p>A problem with this search strategy is that it assumes that the raised third
will occur in the final sonority prior to the double barline. One possible
confound might be the presence of one or more rests following the final
chord. This situation is evident in Fugue No. 4 from the second volume of
Bach&#8217;s <em>Well-Tempered Clavier</em>:</p>
<p><strong>Example 21.3.</strong> J.S. Bach, <em>Well-Tempered Clavier</em>, Vol. 2, Fugue 4.</p>
<p>&gt; .. image:: guide.figures/guide21.3.gif</p>
<p>&gt;
&gt;&gt; <tt class="docutils literal"><span class="pre">!!!COM:</span> <span class="pre">Bach,</span> <span class="pre">Johann</span> <span class="pre">Sebastian</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``!!!XEN:</span> <span class="pre">The</span> <span class="pre">Well-Tempered</span> <span class="pre">Clavier,</span> <span class="pre">Volume</span> <span class="pre">2,</span> <span class="pre">Fugue</span> <span class="pre">4.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``**kern**kern**kern</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*clefF4*clefG2*clefG2</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*M12/16*M12/16*M12/16</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*k[f#c#g#d#]*k[f#c#g#d#]*k[f#c#g#d#]</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*c#:*c#:*c#:</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``=70=70=70</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16E8.f#]8b#</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16D#..</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16E.16g#</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16FF##8e4.cc#</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16GG#..</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``16AAn16d#.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``4.GG#16e.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``.16a.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``.16g#.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``.16f#8.b#</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``.16e.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``.16d#.</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``=71=71=71</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``8.CC#8.e#8.cc#</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``8.r8.r8.r</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``4.r4.r4.r</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``======</span>
<span class="pre">&gt;&gt;</span> <span class="pre">``*-*-*-</span></tt></p>
<p>The <strong>patt</strong> command provides a <strong>-s</strong> option that allows the user to skip or
ignore certain records in the input. Any regular expression can be given as a
parameter for the <strong>-s</strong> option. In the following pipeline, we have
instruction <strong>patt</strong> to skip over any records matching the lower-case letter
<tt class="docutils literal"><span class="pre">`r</span></tt>&#8216; (the <tt class="docutils literal"><span class="pre">**kern</span></tt> rest signifier):</p>
<p>&gt; <tt class="docutils literal"><span class="pre">deg</span> <span class="pre">``*inputfile.krn*</span></tt> | patt -s r -f picardy``</p>
<p>Even ignoring rests may not be sufficient to identify the raised third near
the double barline. For example, if any other note from the tonic chord
follows after the raised third, then the third will appear several records
prior to the double barline. We can solve this problem by using the
<a href="#id57"><span class="problematic" id="id58">`**ditto**`_</span></a> command discussed in <a class="reference external" href="guide15.html">Chapter 15;</a> <strong>ditto</strong> can be used to
propagate the raised third through the sustained final chord. Our revised
pipeline is:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">deg</span> <span class="pre">bach.krn</span> <span class="pre">|</span> <span class="pre">ditto</span> <span class="pre">-s</span> <span class="pre">=</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-s</span> <span class="pre">r</span> <span class="pre">-f</span> <span class="pre">picardy</span></tt></p>
<p>A similar approach can be used to identify consecutive fifths or octaves
between two voices. A template file (dubbed <tt class="docutils literal"><span class="pre">5ths</span></tt>) might consist of the
following pattern:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">P5</span>
<span class="pre">P5</span></tt></p>
<p>In order to identify consecutive fifths, we might extract two parts of
interest, and then translate to the <a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id59"><span class="problematic" id="id60">`**hint```_</span></a> harmonic-interval
representation. The <strong>-c</strong> option for <a href="#id61"><span class="problematic" id="id62">`**hint**`_</span></a> collapses compound
intervals to their non-compound equivalents so consecutive twelfths,
nineteenths, etc. will also be identified. In the following command pipeline,
notice the use of the <strong>-s</strong> option for <a href="#id63"><span class="problematic" id="id64">`**patt**`_</span></a> in order to skip
barlines. This ensures that crossing a barline does not result in a failure
to identify a consecutive fifth.</p>
<p>&gt; <tt class="docutils literal"><span class="pre">extract</span> <span class="pre">-i</span> <span class="pre">'*Ibass,*Itenor'</span> <span class="pre">Fux</span> <span class="pre">|</span> <span class="pre">hint</span> <span class="pre">-c</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-s</span> <span class="pre">=</span> <span class="pre">-f</span> <span class="pre">5ths</span></tt></p>
<p>Sometimes patterns will tend to be obscured by the presence of other
information. For example, suppose we want to identify possible Landini
cadences such as the cadence shown in Example 21.4. Landini cadences are
common in much 14th century polyphony including works by Machaut, Caserta,
Dufay, Ciconia, as well as Landini. One characteristic of the Landini cadence
is the distinctive three-note <em>ti -&gt; la -&gt; do</em> in the upper-most part. The
submediant pitch is interposed between the leading-tone and the tonic. A
second characteristic of the Landini cadence is the harmonic relationship
between the highest and lowest voices. Three intervals are formed: <em>sixth -&gt;
fifth -&gt; octave</em>. Either one or both of these characteristics might be used
to help identify this distinctive cadential formula.</p>
<p><strong>Example 21.4.</strong> Francesco Landini, Excerpt from <em>Non avra ma&#8217; pieta</em>.</p>
<p>&gt; .. image:: guide.figures/guide21.4.gif</p>
<p>Below is a <a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id65"><span class="problematic" id="id66">`**kern```_</span></a> encoding of the final two measures along with
corresponding <a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id67"><span class="problematic" id="id68">`**hint```_</span></a> and <a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id69"><span class="problematic" id="id70">`**deg```_</span></a> spines. The <strong>hint spine was
generated using `**hint**`_ **-l</strong> in order to generate intervals with
respect to the lowest pitch.</p>
<p>&gt; <tt class="docutils literal"><span class="pre">!!!COM:</span> <span class="pre">Landini,</span> <span class="pre">Francesco</span>
<span class="pre">&gt;</span> <span class="pre">``**kern``**kern``**kern``**hint``**deg**deg**deg</span>
<span class="pre">&gt;</span> <span class="pre">``*clefF4``*clefG2``*clefG2``*``*``*``*</span>
<span class="pre">&gt;</span> <span class="pre">``*M3/4``*M3/4``*M3/4``*M3/4``*M3/4``*M3/4``*M3/4</span>
<span class="pre">&gt;</span> <span class="pre">``=``=``=``=``=``=``=</span>
<span class="pre">&gt;</span> <span class="pre">``4A``4e``8e``P5</span> <span class="pre">P5``v2``v6``^6</span>
<span class="pre">&gt;</span> <span class="pre">``.</span></tt>.``8f``-..``^7-
&gt; <tt class="docutils literal"><span class="pre">4B-``4d``8g``M3</span> <span class="pre">M6``^3-``v5^1</span>
<span class="pre">&gt;</span> <span class="pre">``.</span></tt>.``4f#``-..``v7
&gt; <tt class="docutils literal"><span class="pre">4A``4c#</span></tt>.``M3``v2``v4+.
&gt; <tt class="docutils literal"><span class="pre">.</span></tt>.``8e``-..``v6
&gt; <tt class="docutils literal"><span class="pre">=``=``=``=``=``=``=</span>
<span class="pre">&gt;</span> <span class="pre">``2.G``2.d``2.g``P5</span> <span class="pre">P8``v1``^5``^1</span>
<span class="pre">&gt;</span> <span class="pre">``==``==``==``========</span>
<span class="pre">&gt;</span> <span class="pre">``*-``*-``*-``*-*-*-*-</span></tt></p>
<p>Notice that <strong>hint</strong> has failed to generate the passing interval forming the
perfect fifth between the E and the A. This can be remedied by using
<strong>ditto</strong> to duplicate all of the pitches. This will cause <strong>hint</strong> to
generate all of the passing harmonic intervals. The revised <a href="#id13"><span class="problematic" id="id14">**</span></a>hint spine is
given below.</p>
<p>&gt; <tt class="docutils literal"><span class="pre">!!!COM:</span> <span class="pre">Landini,</span> <span class="pre">Francesco</span>
<span class="pre">&gt;</span> <span class="pre">``**kern**kern**kern**hint**deg**deg**deg</span>
<span class="pre">&gt;</span> <span class="pre">``*clefF4*clefG2*clefG2****</span>
<span class="pre">&gt;</span> <span class="pre">``*M3/4*M3/4*M3/4*M3/4*M3/4*M3/4*M3/4</span>
<span class="pre">&gt;</span> <span class="pre">``=======</span>
<span class="pre">&gt;</span> <span class="pre">``4A4e8eP5</span> <span class="pre">P5v2v6^6</span>
<span class="pre">&gt;</span> <span class="pre">``..8fP5</span> <span class="pre">m6..^7-</span>
<span class="pre">&gt;</span> <span class="pre">``4B-4d8gM3</span> <span class="pre">M6^3-v5^1</span>
<span class="pre">&gt;</span> <span class="pre">``..4f#M3</span> <span class="pre">A5..v7</span>
<span class="pre">&gt;</span> <span class="pre">``4A4c#.M3</span> <span class="pre">M6v2v4+.</span>
<span class="pre">&gt;</span> <span class="pre">``..8eM3</span> <span class="pre">P5..v6</span>
<span class="pre">&gt;</span> <span class="pre">``=======</span>
<span class="pre">&gt;</span> <span class="pre">``2.G2.d2.gP5</span> <span class="pre">P8v1^5^1</span>
<span class="pre">&gt;</span> <span class="pre">``==============</span>
<span class="pre">&gt;</span> <span class="pre">``*-*-*-*-*-*-*-</span></tt></p>
<p>One way to identify Landini cadences is to use the following harmonic-
interval template file (dubbed <tt class="docutils literal"><span class="pre">LandCadence</span></tt>):</p>
<p>&gt; <tt class="docutils literal"><span class="pre">6</span>
<span class="pre">&gt;</span> <span class="pre">``5</span>
<span class="pre">&gt;</span> <span class="pre">``8</span></tt></p>
<p>Using this template, we can identify Landini cadences as follows. (Notice the
use of <strong>-s ^=</strong> to skip barlines.)</p>
<p>&gt; <tt class="docutils literal"><span class="pre">ditto</span> <span class="pre">-s</span> <span class="pre">^=</span> <span class="pre">input</span> <span class="pre">|</span> <span class="pre">hint</span> <span class="pre">-l</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-s</span> <span class="pre">^=</span> <span class="pre">-f</span> <span class="pre">LandCadence</span></tt></p>
<p>It is possible that the 6-5-8 figured bass might arise in non-cadential
situations, so a more circumspect template might also include some scale-
degree movements as well. The following template file (dubbed <tt class="docutils literal"><span class="pre">Landini-</span>
<span class="pre">Cadence</span></tt>) combines both the harmonic-interval and scale-degree data:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">[Mm]6</span>
<span class="pre">P5.*v6</span>
<span class="pre">P8.*\^1</span></tt></p>
<p>Using this more sophisticated pattern template, a suitable sequence of
commands would be the following:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">ditto</span> <span class="pre">-s</span> <span class="pre">^=</span> <span class="pre">inputfile</span> <span class="pre">|</span> <span class="pre">hint</span> <span class="pre">-l</span> <span class="pre">&gt;</span> <span class="pre">temp1</span>
<span class="pre">deg</span> <span class="pre">inputfile</span> <span class="pre">&gt;</span> <span class="pre">temp2</span>
<span class="pre">assemble</span> <span class="pre">temp1</span> <span class="pre">temp2</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-s</span> <span class="pre">^=</span> <span class="pre">-f</span> <span class="pre">Landini-Cadence</span></tt></p>
<p>In general, <strong>patt</strong> templates can be used to specify both concurrent
conditions as well as dynamic or temporal conditions. This allows users to
define patterns involving a multitude of conditions involving many different
types of data.</p>
</div>
<div class="section" id="using-patt-s-tag-option">
<h2>Using <em>patt</em>&#8216;s Tag Option<a class="headerlink" href="#using-patt-s-tag-option" title="Permalink to this headline">¶</a></h2>
<p>So far, we have seen that <a href="#id71"><span class="problematic" id="id72">`**patt**`_</span></a> provides two kinds of output. In the
default operation, <strong>patt</strong> outputs a simple global comment each time it
finds a matching segment in the input. With the <strong>-e</strong> option, <strong>patt</strong> will
also echo the specific passage(s) found. In addition, <strong>patt</strong> provides a
third type of output using the <strong>-t</strong> option.</p>
<p>When the <strong>-t</strong> option is invoked, <strong>patt</strong> will output the original input,
plus an addition <tt class="docutils literal"><span class="pre">**patt</span></tt> spine. The <tt class="docutils literal"><span class="pre">**patt</span></tt> spine typically consists of
mostly null tokens. However, each time the input matches the sought pattern,
a user-defined &#8220;tag&#8221; will appear in the <tt class="docutils literal"><span class="pre">**patt</span></tt> spine. Consider the
following example.</p>
<p>Suppose we are interested in identifying deceptive cadences in Bach&#8217;s chorale
harmonizations. Imagine that we already have a <a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id73"><span class="problematic" id="id74">`**harm```_</span></a> spine containing
a Roman numeral harmonic analysis. There are different ways of defining a
deceptive cadence, but a frequent definition is that it involves a dominant
chord followed by a submediant chord in a cadential context. In the case of
Bach&#8217;s chorale harmonizations, cadences are readily identified by the pause
symbol. Our search template might look as follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">^V([^I]|$)</span>
<span class="pre">(vi)|(VI);</span></tt></p>
<p>This template means: &#8220;look for an upper-case letter <tt class="docutils literal"><span class="pre">V</span></tt> appearing at the
beginning of a line that is followed by either the end of the line (<tt class="docutils literal"><span class="pre">$</span></tt>) or
by a character other than the upper-case letter <tt class="docutils literal"><span class="pre">I</span></tt>. This record will be
followed by a record containing either <tt class="docutils literal"><span class="pre">vi</span></tt> or <tt class="docutils literal"><span class="pre">VI</span></tt> followed by a
semicolon.&#8221;</p>
<p>When invoking the <strong>patt</strong> command, we can specify our preferred output tag
along with the <strong>-t</strong> option as follows:</p>
<p>&gt; <tt class="docutils literal"><span class="pre">extract</span> <span class="pre">-i</span> <span class="pre">'**harm'</span> <span class="pre">bwv269.krn</span> <span class="pre">|</span> <span class="pre">patt</span> <span class="pre">-f</span> <span class="pre">template</span> <span class="pre">-t</span> <span class="pre">deceptive</span></tt></p>
<p>&gt; <tt class="docutils literal"><span class="pre">**harm**patt</span>
<span class="pre">&gt;</span> <span class="pre">``I.</span>
<span class="pre">&gt;</span> <span class="pre">``I.</span>
<span class="pre">&gt;</span> <span class="pre">``ii7.</span>
<span class="pre">&gt;</span> <span class="pre">``Vdeceptive</span>
<span class="pre">&gt;</span> <span class="pre">``vi;.</span>
<span class="pre">&gt;</span> <span class="pre">``V.</span>
<span class="pre">&gt;</span> <span class="pre">``I.</span>
<span class="pre">&gt;</span> <span class="pre">``IV.</span>
<span class="pre">&gt;</span> <span class="pre">``IV.</span>
<span class="pre">&gt;</span> <span class="pre">``I.</span>
<span class="pre">&gt;</span> <span class="pre">``V;.</span></tt>
&gt; etc.</p>
<blockquote>
<div>In <a class="reference external" href="guide26.html">Chapter 26</a> we will learn how to collapse several spines into a single
spine. This will allow us to assemble the results from several &#8220;passes&#8221;
using <strong>patt</strong> &#8211; one pass for each type of cadence. For example, we could
collapse several tagged outputs to produce a single spine that identifies
all of the various types of cadences:</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">**harm**cadences</span>
<span class="pre">I.</span>
<span class="pre">I.</span>
<span class="pre">ii7.</span>
<span class="pre">Vdeceptive</span>
<span class="pre">vi;.</span>
<span class="pre">V.</span>
<span class="pre">I.</span>
<span class="pre">IV.</span>
<span class="pre">IV.</span>
<span class="pre">Ihalf</span>
<span class="pre">V;.</span></tt>
etc.</p>
<blockquote>
<div>There are no restrictions as to the types of tags that can be generated by
<strong>patt</strong>. A user might tag the beginning of motivic or thematic statements,
various harmonic progressions, variation techniques, fingering patterns,
quotations or allusions, stylistic cliches, etc. In <a class="reference external" href="guide35.html">Chapter 35</a> we will
use the <strong>-t</strong> option to label different set forms for statements of a
twelve-tone row, such as primes, inversions, retrogrades, and retrograde
inversions. We will use suitable tags to identify the specific
transpositions: P0, I7, R11, RI8, etc.</div></blockquote>
</div>
<div class="section" id="matching-multiple-records-using-the-patt-command">
<h2>Matching Multiple Records Using the <em>patt</em> Command<a class="headerlink" href="#matching-multiple-records-using-the-patt-command" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Twelve-tone music raises several special issues for sequential pattern
matching. For example, it is common in serial music to collapse segments of
a tone-row in order to create vertical chords. Consider the following
excerpt from Ernst Krenek&#8217;s suite for solo &#8216;cello. The tone row consists of
the ordered pitches: D, G-flat, F, D-flat, C, B, E-flat, A, B-flat, A-flat,
E, G.</div></blockquote>
<p><strong>Example 21.5.</strong> Ernst Krenek, Opus 84 <em>Suite for Violoncello</em>; mov. 1,
measures 28-30.</p>
<p>&gt; .. image:: guide.figures/guide21.5.gif</p>
<blockquote>
<div>Using a pitch-class representation we would search for the sequence:</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">2</span>
<span class="pre">6</span>
<span class="pre">5</span>
<span class="pre">1</span>
<span class="pre">0</span>
<span class="pre">11</span>
<span class="pre">3</span>
<span class="pre">9</span>
<span class="pre">10</span>
<span class="pre">8</span>
<span class="pre">4</span>
<span class="pre">7</span></tt></p>
<blockquote>
<div>Due to the diads, however, the corresponding pitch-class representation for
the above Krenek passage would be:</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">**pc</span>
<span class="pre">2</span>
<span class="pre">6</span>
<span class="pre">5</span> <span class="pre">1</span>
<span class="pre">0</span>
<span class="pre">=</span>
<span class="pre">3</span> <span class="pre">11</span>
<span class="pre">9</span>
<span class="pre">10</span>
<span class="pre">10</span> <span class="pre">8</span>
<span class="pre">=</span>
<span class="pre">7</span> <span class="pre">4</span></tt>
etc.
<tt class="docutils literal"><span class="pre">*-</span></tt></p>
<blockquote>
<div>The <strong>-m</strong> option for <a href="#id75"><span class="problematic" id="id76">`**patt**`_</span></a> invokes a &#8220;multi-record matching&#8221; mode.
In this mode, <strong>patt</strong> attempts to match as many successive regular
expressions in the template file as possible for a given input record,
before continuing with the next input and template records. In this way,
several records in the template file may possibly match a single input
record. In the above case, the tone-row template will be matched and the
<a href="#id17"><span class="problematic" id="id18">`</span></a>P0&#8217; tag issued if the following command is issued:</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">patt</span> <span class="pre">-f</span> <span class="pre">tonerow</span> <span class="pre">-t</span> <span class="pre">P0</span> <span class="pre">-m</span> <span class="pre">Krenek</span></tt></p>
</div>
<div class="section" id="the-pattern-command">
<h2>The <em>pattern</em> Command<a class="headerlink" href="#the-pattern-command" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Not all patterns can be identified using <strong>patt</strong>. The Humdrum
<a href="#id77"><span class="problematic" id="id78">`**pattern**`_</span></a> command permits an additional regular expression feature that
is especially useful in musical applications. Specifically, <strong>pattern</strong>
permits the defining of patterns spanning more than one line or record.
Record-repetition operators are specified by following the regular
expression with a tab &#8211; followed by either <tt class="docutils literal"><span class="pre">+</span></tt>, <tt class="docutils literal"><span class="pre">*</span></tt>, or <tt class="docutils literal"><span class="pre">?</span></tt>. For
example, consider the following Humdrum-extension regular expression:</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">X+</span>
<span class="pre">Y*</span>
<span class="pre">Z?</span></tt></p>
<blockquote>
<div><p>When the metacharacters <tt class="docutils literal"><span class="pre">+</span></tt>, <tt class="docutils literal"><span class="pre">*</span></tt>, or <tt class="docutils literal"><span class="pre">?</span></tt> appear at the end of a
record, preceded by a tab character, they pertain to the number of records,
rather than the number of repetitions of the expression within a record. The
first record of the regular expression (<tt class="docutils literal"><span class="pre">X``**``+</span></tt>) will match one or more
successive lines each containing the letter <tt class="docutils literal"><span class="pre">`X</span></tt>&#8216;. The second record of
the regular expression (<tt class="docutils literal"><span class="pre">Y``**``*</span></tt>) will match zero or more subsequent
lines containing the letter <tt class="docutils literal"><span class="pre">`Y</span></tt>&#8216;. The third record of the regular
expression (<tt class="docutils literal"><span class="pre">Z``**</span></tt>?``) will match zero or one line containing the letter
<tt class="docutils literal"><span class="pre">`Z</span></tt>&#8216;. Hence, the above multi-record regular expression would match an
input such as the following: three successive lines containing the letter
<tt class="docutils literal"><span class="pre">`X</span></tt>&#8216;, followed by eight successive lines containing the letter <tt class="docutils literal"><span class="pre">`Y</span></tt>&#8216;,
followed by a single line containing the letter <tt class="docutils literal"><span class="pre">`Z</span></tt>&#8216;. Similarly, the
above regular expression would match an input containing one line containing
the letter <tt class="docutils literal"><span class="pre">`X</span></tt>&#8216;.</p>
<p>Record-repetition operators can be used in conjunction with all of the
other regular expression features. For example, the following regular
expression matches one or more successive <tt class="docutils literal"><span class="pre">`**kern```_</span> <span class="pre">data</span> <span class="pre">records</span>
<span class="pre">containing</span> <span class="pre">the</span> <span class="pre">pitch</span> <span class="pre">```G</span></tt>&#8216; (naturals only) followed optionally by a single
<tt class="docutils literal"><span class="pre">`G#</span></tt>&#8216; followed by one or more records containing one or more pitches from
an A major triad &#8211; the last of which must end a phrase:</p>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a></p>
</div></blockquote>
<p>&gt; [Gg]+[^#-] +
[Gg]+#[^#] ?
([Aa]+|([Cc]+#)|[Ee]+)[^#-] *
(}.*([Aa]+|([Cc]+#)|[Ee]+)[^#-]))|(([Aa]+|([Cc]+#)|[Ee]+)[^#-].*})</p>
<blockquote>
<div><a href="#id21"><span class="problematic" id="id22">``</span></a></div></blockquote>
</div>
<div class="section" id="patterns-of-patterns">
<h2>Patterns of Patterns<a class="headerlink" href="#patterns-of-patterns" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Music often exhibits hierarchical structures where particular types of
patterns may be embedded in other patterns, or where low-level patterns join
together to form higher-level patterns. As we have seen, the <strong>-t</strong> (tag)
option for the <strong>patt</strong> command allows a new output spine to be generated.
This spine contains user-defined labels marking the beginning of each found
pattern. The labels can contain any user-defined text string such as
<tt class="docutils literal"><span class="pre">authentic</span> <span class="pre">cadence</span></tt>, <tt class="docutils literal"><span class="pre">episode</span></tt>, <tt class="docutils literal"><span class="pre">Motive</span> <span class="pre">3b</span></tt>, <tt class="docutils literal"><span class="pre">augmentation</span></tt>,
<tt class="docutils literal"><span class="pre">triplet</span> <span class="pre">figuration</span></tt>, or <tt class="docutils literal"><span class="pre">prolongation</span></tt>.</p>
<p>As we will see in <a href="#id79"><span class="problematic" id="id80">`Chapter 26,`_</span></a> the contents of several spines can be
amalgamated to form a single spine. This means that the results for several
independent pattern searches can be assembled into a single &#8220;pattern&#8221; spine.
Several pattern spines may be created that related to patterns found at
different hierarchical levels, or patterns found using different search
methods. Of course, these pattern-spines themselves can be used as input to
further pattern searches thus providing unbounded possibilities for
searching for patterns of patterns.</p>
<p>Consider, for example, the following template for the <a href="#id81"><span class="problematic" id="id82">`**pattern**`_</span></a>
command:</p>
</div></blockquote>
<p>&gt; <tt class="docutils literal"><span class="pre">Theme</span> <span class="pre">1</span> <span class="pre">(tonic)+</span>
<span class="pre">Bridge*</span>
<span class="pre">Theme</span> <span class="pre">2</span> <span class="pre">(tonic)+</span>
<span class="pre">Coda?</span></tt></p>
<blockquote>
<div>The template reads &#8220;one or more instances of <tt class="docutils literal"><span class="pre">Theme</span> <span class="pre">1</span> <span class="pre">(tonic)</span></tt>, followed
by zero or more instances of <tt class="docutils literal"><span class="pre">Bridge</span></tt>, followed by one or more instances
of <tt class="docutils literal"><span class="pre">Theme</span> <span class="pre">2</span> <span class="pre">(tonic)</span></tt>, followed by zero or one instance of <tt class="docutils literal"><span class="pre">Coda</span></tt>.&#8221; This
template might be used by <strong>pattern</strong> to identify a Recapitulation. Together
with outputs from parallel searches for <a href="#id23"><span class="problematic" id="id24">`</span></a>Exposition&#8217; and <a href="#id25"><span class="problematic" id="id26">`</span></a>Development&#8217; the
results of a <a href="#id27"><span class="problematic" id="id28">`</span></a>Recapitulation&#8217; search might similarly be amalgamated and used
as an input for a higher level search for works exhibiting a sonata-allegro
structure.</div></blockquote>
</div>
<div class="section" id="reprise">
<h2>Reprise<a class="headerlink" href="#reprise" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In this chapter and previous chapters we have identified several search-
related tools, including the UNIX <strong>grep</strong> and <strong>egrep</strong> commands as well as
the Humdrum <a href="#id83"><span class="problematic" id="id84">`**patt**`_</span></a> and <a href="#id85"><span class="problematic" id="id86">`**pattern**`_</span></a> commands. Each of these tools has
different strengths and weaknesses and it is not always clear which tool is
best for a given task. When searching, don&#8217;t forget to consider how
<a href="#id87"><span class="problematic" id="id88">`**context**`_</span></a>, <a href="#id89"><span class="problematic" id="id90">`**humsed**`_</span></a>, <a href="#id91"><span class="problematic" id="id92">`**rid**`_</span></a> and other tools might facilitate
the searching task. In future chapters will will consider how &#8220;similarity&#8221;
tools such as <a href="#id93"><span class="problematic" id="id94">`**correl**`_</span></a> and <a href="#id95"><span class="problematic" id="id96">`**simil**`_</span></a> can contribute to more
sophisticated pattern searches.</p>
<ul class="simple">
<li>` <a href="#id29"><span class="problematic" id="id30">**</span></a>Next Chapter**`_</li>
<li>` <a href="#id31"><span class="problematic" id="id32">**</span></a>Previous Chapter**`_</li>
<li>` <a href="#id33"><span class="problematic" id="id34">**</span></a>Table of Contents**`_</li>
<li>` <a href="#id35"><span class="problematic" id="id36">**</span></a>Detailed Contents**`_</li>
</ul>
</div></blockquote>
<ol class="upperalpha simple" start="3">
<li>Copyright 1999 David Huron</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">humdrum-tools 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Humdrum Community.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>